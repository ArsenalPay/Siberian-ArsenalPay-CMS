## Version
v4.1.5
 
_Has been tested on Siberian PE - v4.15.3; Subscription module v4.15.3_

### О модуле


Модуль платежной системы "ArsenalPay" для Siberian CMS под Subscription module позволяет легко встроить платежную страницу на Ваш сайт.
После установки модуля у Вас появится новый вариант оплаты товаров и услуг через платежную систему "ArsenalPay".
Платежная система "ArsenalPay" позволяет совершать оплату с различных источников списания средств: мобильных номеров
(МТС/Мегафон/Билайн/TELE2), пластиковых карт (VISA/MasterCard/Maestro). Перечень доступных источников средств постоянно
пополняется. Следите за обновлениями.


За более подробной информацией о платежной системе ArsenalPay зайдите на http://arsenalpay.ru.

---
### Установка

Для установки платежного модуля ArsenalPay необходимо:
1. Скачать последнюю версию модуля из [репозитория](https://github.com/ArsenalPay/Siberian-ArsenalPay-CMS/releases)
2. Перейти на страницу backoffice : http://адрес\_вашего\_сайта/backoffice
3. Перейти в раздел **Settings -> Modules**
4. Загрузить файл с архивом модуля используя форму и после этого на этой же странице в **"Module to upload"**
нажать на кнопку загрузки
5. На этой же странице ниже нажать кнопку **install**

---

### Настройка

Сообщите нам 
* URL колбэка платежа (Callback URL): http(s)://ваш_домен/payment/arsenalpay/callback
* URL для редиректа со страницы оплаты:  http(s)://ваш_домен/payment/arsenalpay/success

1. Перейти на страницу backoffice и перейти в раздел с API ключами: Settings->APIs
2. Настроить параметры:
- Widget ID - Уникальный идентификатор виджета , обязательный;
- Callback key - Ключ для проверки подписи запросов, обязательный;
- Widget Key - Ключ для проверки виджета, обязательный;
- Client Id - Идентификатор для доступа к  методам API Arsenalpay, обязательный;
- Client Secret - Секретный ключ для доступа к  методам API Arsenalpay, обязательный;

---
### Для разработчиков

1. Для ежедневной проверки статуса подписок, оплаченных при помощи ArsenalPay необходимо в файл /lib/Siberian/Cron.php
в функцию **checkpayments** в блок **try** добавить строку 
```
Payment_ArsenalpayController::checkRecurrencies();
```

Чтобы функция выглядела так:
```
public function checkpayments($task) {
        $this->lock($task->getId());

        try {
            Payment_PaypalController::checkRecurrencies();
            Payment_ArsenalpayController::checkRecurrencies();
        } catch(Exception $e){
            $this->log($e->getMessage());
            $task->saveLastError($e->getMessage());
        }

        $this->unlock($task->getId());
    }
```

------------------
### Управление подписками
При оплате заказа, пользователь может подключить ежемесячный автоплатеж в виджете оплаты.

Управление подписками происходит в соответсвующем разделе backoffice\`a Siberain CMS. (перейдите на главную страницу backoffice\`а (https://ваш_домен//backoffice) 
и выберите в меню навигации **Управление**->**Подписки** ).

* Если автоплатеж активен на стороне Arsenalpay, то в поле Platform, будет надпись "ArsenalPay" на **зеленом** фоне, если подписка неактивна, то надпись будет
находиться на **красном** фоне (!для единоразового платежа, надпись будет всегда находиться на красном фоне, т.к. на стороне Arsenalpay
нет автоплатежа).

* Для приостановки автоплатежа(подписки) со стороны CMS, нужно перейти в режим редактирования необходимой подписки,
снять галочку с чекбокса "эта подписка активна" и нажимать "сохранить". Произойдет редирект на список с подписками и появится уведомление о том,
успешно ли модуль удалил автоплатеж на стороне Arsenalpay. Если произошла ошибка, свяжитесь с нами для приостановки подписки.

* Если пользователь сам отменяет автоплатеж на стороне Arsenalpay, то для того, чтобы в Siberian CMS произошла автоматическая 
отмена подписки, необходимо включить ежедневную проверку статуса подписок.
Для этого, нужно выполнить первый пункт, указанный в пункте **"Для разработчиков"**
Кроме того, если был совершен очередной автоплатеж, то во время ежедневной проверки статуса подписок, ваша CMS получит уведомление
об этом. (в базе данных Siberian CMS будет создан соответствующий invoice)

---
### ОПИСАНИЕ РЕШЕНИЯ
ArsenalPay – удобный и надежный платежный сервис для бизнеса любого размера. 

Используя платежный модуль от ArsenalPay, вы сможете принимать онлайн-платежи от клиентов по всему миру с помощью: 
пластиковых карт международных платёжных систем Visa и MasterCard, эмитированных в любом банке
баланса мобильного телефона операторов МТС, Мегафон, Билайн, Ростелеком и ТЕЛЕ2
различных электронных кошельков.

### Преимущества сервиса: 
 - [Самые низкие тарифы](https://arsenalpay.ru/tariffs.html)
 - Бесплатное подключение и обслуживание
 - Легкая интеграция
 - [Агентская схема: ежемесячные выплаты разработчикам](https://arsenalpay.ru/partnership.html)
 - Вывод средств на расчетный счет без комиссии
 - Сервис смс оповещений
 - Персональный личный кабинет
 - Круглосуточная сервисная поддержка клиентов 

А ещё мы можем взять на техническую поддержку ваш сайт и создать для вас мобильные приложения для Android и iOS. 

ArsenalPay – увеличить прибыль просто! 
Мы работаем 7 дней в неделю и 24 часа в сутки. А вместе с нами множество российских и зарубежных компаний. 

### Как подключиться: 
1. Вы скачали модуль и установили его у себя на сайте;
2. Отправьте нам письмом ссылку на Ваш сайт на pay@arsenalpay.ru либо оставьте заявку на [сайте](https://arsenalpay.ru/#register) через кнопку "Подключиться";
3. Мы Вам вышлем коммерческие условия и технические настройки;
4. После Вашего согласия мы отправим Вам проект договора на рассмотрение.
5. Подписываем договор и приступаем к работе.

Всегда с радостью ждем ваших писем с предложениями. 

pay@arsenalpay.ru 

[arsenalpay.ru](https://arsenalpay.ru)
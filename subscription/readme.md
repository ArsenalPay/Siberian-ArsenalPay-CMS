## Version v4.1.5
 
*Has been tested on Siberian PE - v4.15.3; Subscription module v4.15.3*

## Описание
 - ArsenalPay – удобный и надежный платежный сервис для бизнеса любого размера.
 - Самые низкие тарифы.
 - Не нужно покупать или арендовать онлайн кассу, мы создали [готовое решение](https://arsenalpay.ru/cashbox.html) для отправки фискальных чеков.
 - Платежный виджет настраивается под цвета вашего сайта
 - Деньги перечисляются на ваш расчетный счет ежедневно за минусом комиссии. Без каких-либо лимитов, минимальных сумм или звёздочек в договоре
 
![картинка](https://arsenalpay.ru/images/1-ArsenalPay-priem-platezhej-na-sajte-besplatnaya-onlajn-kassa.png "Прием платежей на сайте")

## Тарифы
2,6% за успешный платеж. Снижаем комиссию при обороте свыше 1 млн. Подключение и интеграция бесплатно.

Используя ArsenalPay, Вы сможете принимать онлайн платежи при помощи:
 - банковских карт Visa, MasterCard, Maestro и Мир, выпущенных в любом банке мира
 - баланса мобильного телефона операторов МТС, Мегафон, Билайн и Теле2
 - различных электронных кошельков

Платежные инструменты ArsenalPay прошли самую высокую международную сертификацию – в соответствии со максимальным стандартом безопасности данных индустрии платёжных карт PCI DSS.

## Онлайн касса не нужна
Вам не нужно покупать или арендовать свою онлайн кассу – мы создали готовое решение для отправки фискальных чеков: ваш клиент оплачивает покупку в интернет магазине через платежную систему ArsenalPay. Чек отправляется на email вашего клиента, а информация о платеже через ОФД поступает в налоговую.
![картинка](https://arsenalpay.ru/images/2-ArsenalPay-onlajn-kassa-besplatno.png "Онлайн касса бесплатно")

Все платежи проходят через онлайн кассу ArsenalPay. Мы выступаем как агент и отправляем чеки от имени нашего сервиса. В чеке указывается ИНН вашего ИП или юридического лица, а также все необходимые данные, в соответствии с законом 54-ФЗ.

Вам не придется тратить более 40 тысяч рублей в год на покупку или аренду кассы и фискального накопителя. Все затраты и задачи по ведению онлайн касс и отправке фискальных чеков лежат на ArsenalPay и включены в комиссию за эквайринг.

## Личный кабинет
Один из основных инструментов контроля приема платежей в интернет: статистика и история платежей, фильтрация и удобный поиск, настройки, частичные и полные возвраты, подтверждение двухэтапных (зарезервированных) платежей, выставление счетов, экспорт реестров и многое другое.
![картинка](https://arsenalpay.ru/images/3-ArsenalPay-fiskalnye-cheki-v-lichnom-kabinete.png "Удобный личный кабинет")

Чтобы вам было удобнее, мы в личный кабинет добавили онлайн чеки по каждой транзакции, будь то успешный платеж или отмена покупки. Теперь при оплате фискальный чек отправляется на email вашего клиента, а информация о платеже поступает в налоговую. Все чеки сохраняются в вашем личном кабинете, вы всегда сможете найти, посмотреть или распечатать любой чек.

Теперь вам не только не нужно покупать или арендовать свою онлайн кассу, но и можно пользоваться только одним личным кабинетом для контроля за платежами и онлайн чеками.
![картинка](https://arsenalpay.ru/images/4-ArsenalPay-fiskalnye-cheki-v-vashem-mobilnom.png "Все чеки у вас в мобильном")

## Быстрый старт
Тем кто не хочет заниматься настройкой сайта и хочет максимально оперативно включить прием платежей, мы предоставляем сервис Быстрый старт.

Вы получаете полностью готовое решение для приема платежей, не нужно тратить время на интеграцию и подготовку сайта в соответствие с требованиями международных платежных систем. Полученную личную ссылку размещаете на любой странице вашего сайта и начинаете прием платежей в течение 3 дней.

Нужен только ИНН вашей компании. Онлайн касса бесплатно. Покупать или арендовать кассу не нужно.
![картинка](https://arsenalpay.ru/images/5-ArsenalPay-bystryj-start-platezhej-na-sajte-onlajn-kassa-besplatno.png "Быстрый старт")

## Основные этапы подключения
1. Установите приложение в ваш интернет магазин.
2. [Зарегистрируйтесь](https://arsenalpay.ru/dashboard/register?step=1) у нас в сервисе
3. Вам будет предоставлен личный кабинет, где сразу же получите все необходимые параметры для настройки приложения:
- идентификатор виджета (widgetId)
- секретный ключ виджета (widgetKey)
- секретный ключ для callback-уведомлений (callbackKey)
4. Сообщите нам URL для callback-уведомлений из настроек вашего приложения, чтобы после успешного платежа в вашем магазине обновлялся статус заказа.
5. Подписываем договор и приступаем к работе.

![картинка](https://arsenalpay.ru/images/6-ArsenalPay-vidzhet-oplaty-v-firmennyx-cvetax-vashego-sajta.png "Виджет оплаты в ваших фирменных цветах")


## Установка

Для установки платежного модуля ArsenalPay необходимо:
1. Скачать последнюю версию модуля из [репозитория](https://github.com/ArsenalPay/Siberian-ArsenalPay-CMS/releases)
2. Перейти на страницу backoffice : http://адрес\_вашего\_сайта/backoffice
3. Перейти в раздел **Settings -> Modules**
4. Загрузить файл с архивом модуля используя форму и после этого на этой же странице в **"Module to upload"**
нажать на кнопку загрузки
5. На этой же странице ниже нажать кнопку **install**


## Настройка

Сообщите нам 
* URL колбэка платежа (Callback URL): http(s)://ваш_домен/payment/arsenalpay/callback
* URL для редиректа со страницы оплаты:  http(s)://ваш_домен/payment/arsenalpay/success

1. Перейти на страницу backoffice и перейти в раздел с API ключами: Settings->APIs
2. Настроить параметры:
- Widget ID - Уникальный идентификатор виджета , обязательный;
- Callback key - Ключ для проверки подписи запросов, обязательный;
- Widget Key - Ключ для проверки виджета, обязательный;
- Client Id - Идентификатор для доступа к  методам API Arsenalpay, обязательный;
- Client Secret - Секретный ключ для доступа к  методам API Arsenalpay, обязательный;

## Для разработчиков

1. Для ежедневной проверки статуса подписок, оплаченных при помощи ArsenalPay необходимо в файл /lib/Siberian/Cron.php
в функцию **checkpayments** в блок **try** добавить строку 
```
Payment_ArsenalpayController::checkRecurrencies();
```

Чтобы функция выглядела так:
```
public function checkpayments($task) {
        $this->lock($task->getId());

        try {
            Payment_PaypalController::checkRecurrencies();
            Payment_ArsenalpayController::checkRecurrencies();
        } catch(Exception $e){
            $this->log($e->getMessage());
            $task->saveLastError($e->getMessage());
        }

        $this->unlock($task->getId());
    }
```


## Управление подписками
При оплате заказа, пользователь может подключить ежемесячный автоплатеж в виджете оплаты.

Управление подписками происходит в соответсвующем разделе backoffice\`a Siberain CMS. (перейдите на главную страницу backoffice\`а (https://ваш_домен//backoffice) 
и выберите в меню навигации **Управление**->**Подписки** ).

* Если автоплатеж активен на стороне Arsenalpay, то в поле Platform, будет надпись "ArsenalPay" на **зеленом** фоне, если подписка неактивна, то надпись будет
находиться на **красном** фоне (!для единоразового платежа, надпись будет всегда находиться на красном фоне, т.к. на стороне Arsenalpay
нет автоплатежа).

* Для приостановки автоплатежа(подписки) со стороны CMS, нужно перейти в режим редактирования необходимой подписки,
снять галочку с чекбокса "эта подписка активна" и нажимать "сохранить". Произойдет редирект на список с подписками и появится уведомление о том,
успешно ли модуль удалил автоплатеж на стороне Arsenalpay. Если произошла ошибка, свяжитесь с нами для приостановки подписки.

* Если пользователь сам отменяет автоплатеж на стороне Arsenalpay, то для того, чтобы в Siberian CMS произошла автоматическая 
отмена подписки, необходимо включить ежедневную проверку статуса подписок.
Для этого, нужно выполнить первый пункт, указанный в пункте **"Для разработчиков"**
Кроме того, если был совершен очередной автоплатеж, то во время ежедневной проверки статуса подписок, ваша CMS получит уведомление
об этом. (в базе данных Siberian CMS будет создан соответствующий invoice)


Всегда с радостью ждем ваших писем с предложениями. 

pay@arsenalpay.ru 

[arsenalpay.ru](https://arsenalpay.ru)
